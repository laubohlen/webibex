{% extends 'layouts/empty.html' %} {% block content %}
<form
    method="POST"
    action="{% url 'test' %}"
>
    {% csrf_token %}
    <div x-data="{ selectedImage: null }">
        <div class="flex items-center [&>div>p]:mb-0 justify-center grid-cols-[{{ gallery_chips|length }}] gap-[{{ gallery_chips|length }}]">
            <div>
                <h3 class="">Query</h3>
                <img
                    src="{{ query_chip.url }}"
                    class=""
                />
                <p>Rank:</p>
                <p>Distance:</p>
            </div>
            {% for chip, distance in gallery_and_distances %}
            <div
                @click="selectedImage = (selectedImage === {{ chip.id }} ? null : {{ chip.id }})"
                :class="{ 'border-blue-600 ring-2 ring-blue-600 bg-blue-100': selectedImage === {{ chip.id }}, 
                'hover:bg-blue-100': selectedImage !== {{ chip.id }}}"
                class="border-2 border-transparent cursor-pointer"
            >
                <h3 class="">???</h3>
                <img
                    src="{{ chip.url }}"
                    class=""
                />
                <p>{{ forloop.counter }}.</p>
                {% if distance <= threshold %}
                <p class="text-green-400">{{ distance }}</p>
                {% else %}
                <p class="text-red-500">{{ distance }}</p>
                {% endif %}
            </div>
            {% endfor %}

            <!-- Hidden input to carry the selected image state -->
        </div>
        <input
            type="hidden"
            name="selectedImage"
            :value="selectedImage"
        />
        <div class="flex flex-row items-center justify-center gap-8 mt-10 mb-10">
            <a
                href="{% url 'new-ibex' oid=query_chip.id %}"
                class="button"
                >New ID</a
            >
            <button
                type="submit"
                :disabled="!selectedImage"
                :class="{ '!opacity-50 !cursor-not-allowed': !selectedImage, 'bg-blue-500 hover:bg-blue-600': selectedImage }"
                class="button"
            >
                Select ID
            </button>

            {% comment %}
            <p>{{query_chip.id}}</p>
            {% endcomment %}
        </div>
    </div>
</form>
{% endblock %}
